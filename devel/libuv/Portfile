PortSystem          1.0

name                libuv
version             1.13.0

categories          devel
platforms           darwin
maintainers         raimue \
                    openmaintainer
license             {MIT BSD} 

description         Cross-platform asychronous I/O

long_description \
    libuv is a multi-platform support library with a focus on asynchronous I/O.

homepage            http://libuv.org/
master_sites        http://dist.libuv.org/dist/v${version}/
distname            ${name}-v${version}

checksums           rmd160  9e749ac034f422fe9f5f2e8d350eba005fabc4fa \
                    sha256  708e51f8845e1728a2df50d2aa8438dbd97a48d4a86fcbbcdead0c406d710315 \
                    size    1140968

use_autoconf        yes
autoconf.cmd        ./autogen.sh

depends_build       port:automake \
                    port:autoconf \
                    port:libtool \
                    port:pkgconfig

test.run            yes
test.target         check

platform darwin 8 {

configure.cppflags-append -D__DARWIN_UNIX03

# Tiger does not have sendfile in kernel
# use fallback instead
patchfiles-append   patch-scr-unix-fs-sendfile.diff

# src/unix/fs.c:713: error: 'struct stat' has no member named 'st_birthtimespec'
# use fallback instead
patchfiles-append   patch-src-unix-fs-birthtime-use-fallback.diff
patchfiles-append   patch-test-test-fs-birthtime-use-fallback.diff

# tiger doesn't have the fsevents chops for libuv so disable it
patchfiles-append   patch-src-unix-fsevents-tiger.diff

# Tiger has no TIOCPTYGNAME so use fallback
# implementation instead
patchfiles-append patch-src-unix-tty-tiger-guard.diff

}