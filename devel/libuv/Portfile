PortSystem          1.0

name                libuv
version             1.20.3

categories          devel
platforms           darwin
maintainers         raimue \
                    openmaintainer
license             {MIT BSD} 

description         Cross-platform asychronous I/O

long_description \
    libuv is a multi-platform support library with a focus on asynchronous I/O.

homepage            http://libuv.org/
master_sites        http://dist.libuv.org/dist/v${version}/
distname            ${name}-v${version}

checksums           rmd160  11778a1761bb5eb94933abbc692f2c9b29b937b2 \
                    sha256  3bb7aad916c7a5fd0053dcb6adee49905360a2a160f4a59bc62dbe4370328579 \
                    size    1172777

use_autoconf        yes
autoconf.cmd        ./autogen.sh

depends_build       port:automake \
                    port:autoconf \
                    port:libtool \
                    port:pkgconfig

test.run            yes
test.target         check

# add missing strnlen definition
# can be removed if we use legacysupport portgroup instead
patchfiles-append   patch-src-unix-getaddrinfo-strnlen.diff

# Tiger does not have sendfile or copyfile - use fallback instead
# Tiger does not have 'st_birthtimespec' use fallback instead
patchfiles-append   patch-src-unix-fs-Tiger.diff
patchfiles-append   patch-test-test-fs-birthtime-use-fallback.diff

# tiger does not have fsevents framework. Disable it as per iphoneOS.
patchfiles-append   patch-src-unix-fsevents-tiger.diff

# Tiger does not have TIOCPTYGNAME - use fallback instead
patchfiles-append   patch-src-unix-tty-tiger-guard.diff


platform darwin 8 {

    # user some newer function definitions eg unsetenv
	configure.cppflags-append -D__DARWIN_UNIX03
	
	# prevent conflicting opentransport header from being pulled in
	configure.cppflags-append -D__OPENTRANSPORTPROVIDERS__
	
	# Tiger has no libutil
	patchfiles-append   patch-makefile-am-no-libutil-on-Tiger.diff

}